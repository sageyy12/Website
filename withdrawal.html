<!DOCTYPE html>
<html>
    <head> <title>Withdraw</title>
        <link rel="stylesheet" href="reloadCSS.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
        <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body>

      <div class="topnav" id="myTopnav">
        <nav class="nav">
          <div class="logo-content">
            <div class="logo">
              <a href="dashboard.html">
                <img src="images/logo.png"></a>
                  <div class="logo-name">Withdraw</div>
                  <button id="logout">Logout</button>
              </div>
          </div>
      </nav>
      </div>

      <div class="sidebar">
          <i class='bx bx-menu' id="btn"></i>
          <ul class="navList">
              <li>
                  <a href="adminProfile.html">
                  <img src="images/admin.png">
                  <span class="links_name">Admin Profile</span>
                  </a>
                  <span class="tooltip">Admin</span>
              </li>
              <li>
                  <a href="announcement.html">
                  <img src="images/announcement.png">
                  <span class="links_name">Announcement</span>
                  </a>
                  <span class="tooltip">Announcement</span>
              </li>
              <li>
                  <a href="ShuttleDriverAcct.html">
                  <img src="images/Shuttle Drivers Account.png">
                  <span class="links_name">Shuttle Driver’s Account</span>
                  </a>
                  <span class="tooltip">Driver</span>
              </li>
              <li>
                  <a href="CoomutersAcct.html">
                  <img src="images/Commuters Account.png">
                  <span class="links_name">Commuter’s Account</span>
                  </a>
                  <span class="tooltip">Commuter</span>
              </li>
              <li>
                  <a href="complaintsNfeedback.html">
                  <img src="images/Complaints and Feedbacks.png">
                  <span class="links_name">Complaints and Feedbacks</span>
                  </a>
                  <span class="tooltip">Complaints</span>
              </li>
              <li>
                  <a href="boundaryRemit.html">
                  <img src="images/Boundary Remittance.png">
                  <span class="links_name">Boundary Remittance</span>
                  </a>
                  <span class="tooltip">Boundary</span>
              </li>
              <li>
                  <a href="reload.html">
                    <!--img src="images/reload.png"!-->
                  <i class='bx bx-wallet'></i>
                  <span class="links_name">Reload</span>
                  </a>
                  <span class="tooltip">Reload</span>
              </li>
              <li>
                <a href="withdrawal.html">
                  <!--img src="images/reload.png"!-->
                  <i class='bx bx-money-withdraw'></i>
                <span class="links_name">Withdraw</span>
                </a>
                <span class="tooltip">Withdraw</span>
            </li>
          </ul>
      </div>

      <div class="add-record-container">
        <div class="add-record-content">
          <div class="add-record-btn">
            <a href="#print">
              <button type="submit" onclick="PrintTable();" id="btnPrint">PRINT</button>
            </a>
          </div>
        </div>
      </div>

      <div id="dvContents" class="tableDiv">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
        
        <table id="example" class="display" width="100%" cellspacing="0">
          <thead>
          <tr>
            <th>ID</th>
            <th id="tbtname">NAME</th>
            <th>RECEIPT</th>
            <th>CONTACT NUMBER</th>
            <th>TIME</th>
            <th>DATE</th>
            <th>REMARKS</th>
            <th>CONTROL CENTER</th>
          </tr>
        </thead>
        <tbody id="tbody1"></tbody>
  
  
        <!-- The Modal -->
  <div id="seemoreModal">
    <div class="seemoremodal-content">
    <div class="seemoreModal-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
    </div>
    <div class="seemoreModal-body">
      <div id="receiptCont">
        <center>
      <form>
        <label for="csname" id="csnamelabel" class="labs">Commuter's Name: </label>
        <input type="text" id="name" name="name" class="labs"> <br>
        <label for="amount" class="labs">Reload Amount: </label>
        <input type="number" id="amount" name="amount" class="labs"> <br>
        <input type="text" id="namebox" name="amount" class="labs" hidden> <br> <br>
      </form></center>
        <div class="buttons">
          <a href="#"><button class="accept"  onclick="wallet()"><i class="fa fa-check-circle"></i> Accept</button></a>
          <a href="#withdrawal.html"><button class="decline"><i class="fa fa-times-circle"></i> Decline</button></a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal ends here-->
  
  </tbody>
        </table>
      </div>
  
      <!-- <input type="search" id="search_box" placeholder="Search"> -->
  
        <footer class="footer-distributed">
  
          <div class="footer-left">
              <h3>Washington <span>Place</span></h3>
  
              <p class="footer-links">
                  <a href="dashboard.html">Dashboard</a>
                  |
                  <a href="commutersTable.html">All commuters</a>
                  |
                  <a href="login.html">Log in</a>
              </p>
  
              <p id="coltext">DOWNLOAD OUR APP HERE:</p>
              <div class="content">
                <p><a href="https://drive.google.com/file/d/1d8tUT5DQuuEI0k3D9PMNzJ99qE45hrwl/view?usp=sharing"> For commuters click here </a></p>
                <p><a href="https://drive.google.com/file/d/1d8tUT5DQuuEI0k3D9PMNzJ99qE45hrwl/view?usp=sharing"> For drivers click here </a></p>
              </div>
          </div>
  
          <div class="footer-center">
              <div>
                  <i class="fa fa-map-marker"></i>
                  <p><span>Sampaloc II, Dasmariñas,</span>
                      <strong>Philippines</strong></p>
              </div>
  
              <div>
                  <i class="fa fa-phone"></i>
                  <p>0943 302 9424</p>
              </div>
              <div>
                  <i class="fa fa-envelope"></i>
                  <p><a href="mailto:peteregencia@yahoo.com">peteregencia@yahoo.com</a></p>
              </div>
              <div>
                  <i class="fa fa-facebook"></i>
                  <p><a href="https://www.facebook.com/cavitewashington">Washington Place facebook page</a></p>
              </div>
              <div>
                <p class="footer-company-name">Copyright © 2022 <strong>WashingtonPlaceDasmarinas</strong> <br>
                  All rights reserved</p>
              </div>
          </div>
          <div class="footer-right">
              <p class="footer-company-about">
                  <span>About Washington Place Dasmarinas</span>
                  <strong>Washington Place Dasmarinas</strong> Stateland’s newest and to date, the
                  grandest development, is set to rise in the emerging city of Dasmariñas in Cavite. Encompassing 40
                  hectares of prime property along Aguinaldo Highway, it is envisioned to become a landmark community
                  that boasts of modern-themed architectural designs.
              </p>
              <!--div class="footer-icons">
                  <a href="https://www.facebook.com/cavitewashington"><i class="fa fa-facebook"></i></a>
                  <a href="#"><i class="fa fa-instagram"></i></a>
                  <a href="#"><i class="fa fa-linkedin"></i></a>
                  <a href="#"><i class="fa fa-twitter"></i></a>
                  <a href="#"><i class="fa fa-youtube"></i></a>
              </div!-->
          </div>
      </footer>
  
  
      <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script>
  
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  
  
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
      <script id="MainScript">
  
              const firebaseConfig = {
                      apiKey: "AIzaSyBfq-ptJkg7y-hJpyJrVq8x0PNoM4fT7cY",
                      authDomain: "shuttle-go-8d87a.firebaseapp.com",
                      databaseURL: "https://shuttle-go-8d87a-default-rtdb.firebaseio.com",
                      projectId: "shuttle-go-8d87a",
                      storageBucket: "shuttle-go-8d87a.appspot.com",
                      messagingSenderId: "509853219067",
                      appId: "1:509853219067:web:5e6b7fb55bbdba9cc0985e",
                      measurementId: "G-3YGP2PY9QX"
                    };
                    firebase.initializeApp(firebaseConfig);
  
                  console.log(firebase);  
  
        //select all data
        function Select_AllData(){
          firebase.database().ref('withdrawal').once('value', function (snapshot){
            snapshot.forEach(function(childSnapshot){
            var driverr = childSnapshot.val().full_name;
            var receiptt = childSnapshot.val().transaction_ID;
            var contactt = childSnapshot.val().phone_numer;
            var datee = childSnapshot.val().date;
            var statuss = childSnapshot.val().status;
            var timee = childSnapshot.val().time;
            var prof = childSnapshot.val().profile;
            
            AddItemToTable(driverr, receiptt, contactt, statuss, datee, prof);
              });
            });
          }
  
        var studentNo = 0;
        var stdList = [];
  
        function AddItemToTable(driverr, receiptt,contactt,statuss, datee, timee, prof){
        var tbody1 = document.getElementById("tbody1");
        let trow = document.createElement("tr");
        let td0 = document.createElement("td");
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        let td4 = document.createElement("td");
        let td5 = document.createElement("td");
        let td6 = document.createElement("td");
         
          var TDD = receiptt;
        var profile = receiptt;
        stdList.push([driverr, receiptt, contactt, statuss, datee, timee, prof ]);
        
        td0.innerHTML = ++studentNo;
        td1.innerHTML = driverr;
        td2.innerHTML = receiptt;
        td3.innerHTML = contactt;
        td4.innerHTML = datee;
        td5.innerHTML = timee;
        td6.innerHTML = statuss;
           
        var ControlDiv2 = document.createElement("div2");
        ControlDiv2.innerHTML ='<td id="receipt"> <a href="#exampleModalCenter" id="viewBtn1">' +
                          '<button id="myBtn" onclick="FillTboxes('+studentNo+')" data-toggle="modal" data-target="#seemoreModal">View Receipt</button>'
                         
                        
        trow.appendChild(td0);
        trow.appendChild(td1);
        trow.appendChild(ControlDiv2);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);
       // trow.appendChild(td6);
        trow.append(td6);
      
        var ControlDiv3 = document.createElement("div3");  
        ControlDiv3.innerHTML = '<button type="button" id= "addAcct" class="btn btn-primary my-2 ml-2" onclick="FillTboxes('+studentNo+')" data-toggle="modal" data-target="#exampleModalCenter">Edit account </button>'
        ControlDiv3.innerHTML += '<button type="button" id= "addAcct" class="btn btn-primary my-2 ml-2" onclick="deletee('+studentNo+')" data-toggle="modal" data-target="#exampleModalCenter">Archieved</button>'
        trow.appendChild(ControlDiv3);


        var ControlDiv = document.createElement("div");
        ControlDiv.innerHTML = '<input type="hidden" id="h_text'+studentNo+ '" value="Paid">'

        trow.appendChild(ControlDiv);
        tbody1.appendChild(trow);
      
      }
  
      function AddAllItems(boundary) {
            std=0;
            tbody1.innerHTML="";
            boundary.forEach(element => {
              AddItemToTable(element.full_name, element.transaction_ID , element.phone_numer, element.status, element.time, element.date)
            });
          }

          function getAllData() {
              const dbref = firebase.database().ref("withdrawal");
              get(child(dbref, "withdrawal"))
              .then((snapshot) => {
                var commuter = [];
                snapshot.forEach(childSnapshot => {
                  commuter.push(childSnapshot.val());
                });
                AddAllItems(commuter);
              })
          }
  
          function getAllDataRT() {
              const dbRef = firebase.database().ref("withdrawal");

              dbRef.on('value', (snapshot)=>{
                var commuters = [];
                snapshot.forEach(childsnapshot => {
                  commuters.push(childsnapshot.val());
                });
                AddAllItems(commuters);
              })
          }

        window.onLoad = getAllDataRT();   

      //  var driverr = document.getElementById('name');
       var commuterr = document.getElementById('name');
       var amountt = document.getElementById('amount');
       var namebox = document.getElementById('namebox');
  
  
       function FillTboxes(index){
  
          if(index == null){
            commuterr.value = "";
            amountt.value = "";
            namebox.value = "";
            
          }else{
            --index;
            commuterr.value = stdList[index][0];
            namebox.value = stdList[index][1];
          }
        }
  
        function accept(index){
  
         // var remarkss = document.getElementById('remarks')
          var remarkss = document.getElementById('h_text' + index);
          var td = document.getElementById('td' + index);
          --index;
          remarkss.value = stdList[index][0];
          }
          
        function decline(index){
  
         // var remarkss = document.getElementById('remarks')
          var remarkss = document.getElementById('h_text' + index);
          var td = document.getElementById('td' + index);
          --index;
          remarkss.value = stdList[index][0];
          }
  
          function adddd(){
           
            CurrentDate();
            CurrentTime();
            add_reload();
          }
  
          function CurrentDate(){
  
                const datee = new Date();
  
                let day = datee.getDate();
                let month = datee.getMonth() + 1;
                let year = datee.getFullYear();
  
                let currentDate = `${month}-${day}-${year}`;
                date.value = (currentDate);
  
                date.disabled = true;
            }
  
          function CurrentTime(){
            const currentTime = new Date();
            let hours = currentTime.getHours() > 12 ? currentTime.getHours() - 12 : currentTime.getHours();
            let am_pm = currentTime.getHours() >= 12 ? "pm" : "am";
            let minutes = currentTime.getMinutes() < 10 ? "0" + currentTime.getMinutes() : currentTime.getMinutes();
            let timeee = hours + ":" + minutes + " " + am_pm;
            time.value = (timeee);
  
            time.disabled = true;
          }  
  
          function wallet(){
            accept(studentNo);
            update_wallet(studentNo);
          }
  
          function add_reload(){
            firebase.database().ref("withdrawal/" + namebox.value).update(
             {
               contact: contact.value,
               driver: driver.value,
               status:remarks.value,
               amount:amount_reload.value,
               time: time.value, 
               date:date.value
             },
             (error)=>{
               if(error){
                 alert("Account was not created" + error);
               }else{
                 alert("Record successfully added!");
                 $("#exampleModalCenter").modal('hide'); //exampleModalCenter is the id of the modal component
               }
             }
           )
         }
          
          // pang access sa transact id ni Commuter na naka based kay fillTBoxes namebox
          function update_wallet(index){
              var receiptt;
              --index;
              return firebase.database().ref('/Driver/' + namebox.value).once('value').then((snapshot) => {
              receiptt = snapshot.val().wallet;
              
              transact(receiptt);
            });
  
            function transact(receiptt)
            {
              
              var rd = parseInt(receiptt); // rd is the wallet of the driver
              var load = parseInt(amountt.value); // amountt.value is from boundary.
              // alert("rd: " + rd)
              var total = rd - load;
              var newwal = total.toString();
                // after adding maupdate na ulit yung wallet ni comms
                firebase.database().ref("Driver/" + namebox.value).update(
                    {
                      wallet:newwal
                    },
                    (error)=>{
                      if(error){
                        alert("Account was not created" + error);
                      }else{
                        alert("Withdraw amount has succesfully deducted!");
                        // alert("SA WAKAS!!" + newwal);
                        $("#exampleModalCenter").modal('hide'); //exampleModalCenter is the id of the modal component
                      }
                    }
                  )
                  //updating the status of the reload
                  firebase.database().ref("withdrawal/" + namebox.value).update(
                  {
                    status: "Paid"
                  },
                  (error)=>{
                    if(error){
                      alert("Error in loading!" + error);
                    }else{
                      alert("Succesfully updated!");
                      //td is the transaction ID. remarksss is the status. stdlist.index[0] ang laman nyan ay is name
                    }
                  }
                ) 
                }
          }

          function deletee(index){
  
            var remarksss = document.getElementById('h_text' + index);
            var remarksss = document.getElementById('td' + index);
          --index;
          remarksss.value = stdList[index][0];
  
          firebase.database().ref("withdrawal/" + namebox.value).remove().then(
            function(){
              alert("Succesfully archieved!");
                $("#exampleModalCenter").modal('hide'); //exampleModalCenter is the id of the modal component
            }
          )
        }

        //decline btn
        function declinebtn(){
            decline(studentNo);
            update_wallet_decline(studentNo);
          }

        // pang access sa transact id ni Commuter na naka based kay fillTBoxes namebox
        function update_wallet_decline(index){
              var receiptt;
              --index;
              
            return firebase.database().ref('/Commuters/' + namebox.value).once('value').then((snapshot) => {
              receiptt = snapshot.val().wallet;
            });
                  //updating the status of the reload
                  firebase.database().ref("withdrawal/" + namebox.value).update(
                  {
                    status: "Declined"
                  },
                  (error)=>{
                    if(error){
                      alert("Error in loading!" + error);
                    }else{
                      alert("Load request is declined");
                      //td is the transaction ID. remarksss is the status. stdlist.index[0] ang laman nyan ay is name
                    }
                  }
                ) 
                }
        </script>
  
      <!-- printing css starts here  -->
      <style id="table_style" type="text/css">
      @media print{
        a #seemoreBtnModal, #seemoreBtnModal2, #seemoreBtnModal3, #seemoreBtnModal4, #seemoreBtnModal5, #seemoreBtnModal6,
        #seemoreBtnModal7, #seemoreBtnModal8, #seemoreBtnModal9, #seemoreBtnModal10, #seemoreBtnModal11, #seemoreBtnModal12,
        #seemoreBtnModal13, #seemoreBtnModal14, #seemoreBtnModal15{
          color: #3D5A80;
          border-color: transparent;
          background-color: transparent;
        }
  
        td #loaded{
          color: #3d5a80;
          border-color: transparent;
          background-color: transparent;
        }
  
        td #notloaded{
          color: #d60000;
          border-color: transparent;
          background-color: transparent;
        }
        #seemoreModal{
          display: none; /*none*/
        }
        #seemoreModal, .seemoreModal-body #receiptCont img, .seemoreModal-body form{
          display: none;
        }
        table
        {
            border: transparent;
        }
        #example_length label, #example_filter label{ /*show entries number and search*/
          display: none;
        }
      }
      </style>
      <!-- printing css ends here  -->
      </body>
  
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  
      <script>
          let btn= document.querySelector("#btn");
          let sidebar= document.querySelector(".sidebar");
  
          btn.onclick= function(){
            sidebar.classList.toggle("active");
          }
          </script>
        
        <script> //Modal script
      // Get the modal
      var modal = document.getElementById("seemoreModal");
      
      // Get the button that opens the modal
      var btn1 = document.getElementById("myBtn");
      
      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];
      
      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
        modal.style.display = "none";
        modal.style.zIndex = 1;
      }
      
      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
      </script>
  
        <script type="text/javascript"> //printing script
      function PrintTable() {
          var printWindow = window.open('', '', 'height=700,width=1200');
          printWindow.document.write('<html><head><title>Table Contents</title>');
  
          //Print the Table CSS.
          var table_style = document.getElementById("table_style").innerHTML;
          printWindow.document.write('<style type = "text/css">');
          printWindow.document.write(table_style);
          printWindow.document.write('</style>');
          printWindow.document.write('</head>');
  
          //Print the DIV contents i.e. the HTML Table.
          printWindow.document.write('<body>');
          var divContents = document.getElementById("dvContents").innerHTML;
          printWindow.document.write(divContents);
          printWindow.document.write('</body>');
  
          printWindow.document.write('</html>');
          printWindow.document.close();
          printWindow.print();
      }
      </script>
    </body>
  </html>
  